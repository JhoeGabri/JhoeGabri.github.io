<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Captura de cámara</title>
    <link rel="stylesheet" href="./estilo.css">
  </head>
  <body>
    <div id="container">
      <video id="videoElement" autoplay></video>
      <button id="captureButton">Capturar</button>
      <label for="cameraSelect">Seleccionar cámara:</label>
      <select id="cameraSelect">
        <option value="user">Frontal</option>
        <option value="environment">Trasera</option>
      </select>
    </div>

    <script>
      const video = document.getElementById('videoElement');
      const captureButton = document.getElementById('captureButton');
      const cameraSelect = document.getElementById('cameraSelect');

      let activeStream = null;

      function startCamera() {
        const constraints = {
          video: { facingMode: cameraSelect.value }
        };

        navigator.mediaDevices.getUserMedia(constraints)
          .then(stream => {
            if (activeStream) {
              stopCamera();
            }
            video.srcObject = stream;
            activeStream = stream;
          })
          .catch(error => {
            console.error('Error al acceder a la cámara: ', error);
          });
      }

      function stopCamera() {
        if (activeStream) {
          const tracks = activeStream.getTracks();
          tracks.forEach(track => track.stop());
          activeStream = null;
        }
      }

      function captureImage() {
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        const context = canvas.getContext('2d');
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = 'captura.png';
        link.click();
      }

      captureButton.addEventListener('click', captureImage);
      cameraSelect.addEventListener('change', startCamera);

      // Iniciar la cámara con la opción seleccionada por defecto
      startCamera();
    </script>
  </body>
</html>
